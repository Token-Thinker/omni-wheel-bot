<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OWB-Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
        }

        html, body {
            width: 100vw;
            height: 100vh;
            touch-action: none;
            margin: 0;
            overflow: hidden;
            background-color: #121212;
            position: relative;
        }

        body {
            scrollbar-width: none;
        }
    </style>
</head>
<body>
<script>
    var VirtualJoystick	= function(opts)
    {
        opts			= opts			|| {};
        this._container		= opts.container	|| document.body;
        this._strokeStyle	= opts.strokeStyle	|| 'cyan';
        this._stickEl		= opts.stickElement	|| this._buildJoystickStick();
        this._baseEl		= opts.baseElement	|| this._buildJoystickBase();
        this._mouseSupport	= opts.mouseSupport !== undefined ? opts.mouseSupport : false;
        this._stationaryBase	= opts.stationaryBase || false;
        this._baseX		= this._stickX = opts.baseX || 0
        this._baseY		= this._stickY = opts.baseY || 0
        this._limitStickTravel	= opts.limitStickTravel || false
        this._stickRadius	= opts.stickRadius !== undefined ? opts.stickRadius : 100
        this._useCssTransform	= opts.useCssTransform !== undefined ? opts.useCssTransform : false

        this._container.style.position	= "relative"

        this._container.appendChild(this._baseEl)
        this._baseEl.style.position	= "absolute"
        this._baseEl.style.display	= "none"
        this._container.appendChild(this._stickEl)
        this._stickEl.style.position	= "absolute"
        this._stickEl.style.display	= "none"

        this._pressed	= false;
        this._touchIdx	= null;

        if(this._stationaryBase === true){
            this._baseEl.style.display	= "";
            this._baseEl.style.left		= (this._baseX - this._baseEl.width /2)+"px";
            this._baseEl.style.top		= (this._baseY - this._baseEl.height/2)+"px";
        }

        this._transform	= this._useCssTransform ? this._getTransformProperty() : false;
        this._has3d	= this._check3D();

        var __bind	= function(fn, me){ return function(){ return fn.apply(me, arguments); }; };
        this._$onTouchStart	= __bind(this._onTouchStart	, this);
        this._$onTouchEnd	= __bind(this._onTouchEnd	, this);
        this._$onTouchMove	= __bind(this._onTouchMove	, this);
        this._container.addEventListener( 'touchstart'	, this._$onTouchStart	, false );
        this._container.addEventListener( 'touchend'	, this._$onTouchEnd	, false );
        this._container.addEventListener( 'touchmove'	, this._$onTouchMove	, false );
        if( this._mouseSupport ){
            this._$onMouseDown	= __bind(this._onMouseDown	, this);
            this._$onMouseUp	= __bind(this._onMouseUp	, this);
            this._$onMouseMove	= __bind(this._onMouseMove	, this);
            this._container.addEventListener( 'mousedown'	, this._$onMouseDown	, false );
            this._container.addEventListener( 'mouseup'	, this._$onMouseUp	, false );
            this._container.addEventListener( 'mousemove'	, this._$onMouseMove	, false );
        }
    }

    VirtualJoystick.prototype.destroy	= function()
    {
        this._container.removeChild(this._baseEl);
        this._container.removeChild(this._stickEl);

        this._container.removeEventListener( 'touchstart'	, this._$onTouchStart	, false );
        this._container.removeEventListener( 'touchend'		, this._$onTouchEnd	, false );
        this._container.removeEventListener( 'touchmove'	, this._$onTouchMove	, false );
        if( this._mouseSupport ){
            this._container.removeEventListener( 'mouseup'		, this._$onMouseUp	, false );
            this._container.removeEventListener( 'mousedown'	, this._$onMouseDown	, false );
            this._container.removeEventListener( 'mousemove'	, this._$onMouseMove	, false );
        }
    }

    VirtualJoystick.touchScreenAvailable	= function()
    {
        return 'createTouch' in document;
    }

    ;(function(destObj){
        destObj.addEventListener	= function(event, fct){
            if(this._events === undefined) 	this._events	= {};
            this._events[event] = this._events[event]	|| [];
            this._events[event].push(fct);
            return fct;
        };
        destObj.removeEventListener	= function(event, fct){
            if(this._events === undefined) 	this._events	= {};
            if( !(event in this._events)  )	return;
            this._events[event].splice(this._events[event].indexOf(fct), 1);
        };
        destObj.dispatchEvent		= function(event){
            if(this._events === undefined) 	this._events	= {};
            if( this._events[event] === undefined )	return;
            var tmpArray	= this._events[event].slice();
            for(var i = 0; i < tmpArray.length; i++){
                var result	= tmpArray[i].apply(this, Array.prototype.slice.call(arguments, 1))
                if( result !== undefined )	return result;
            }
            return undefined
        };
    })(VirtualJoystick.prototype);

    VirtualJoystick.prototype.deltaX	= function(){ return this._stickX - this._baseX;	}
    VirtualJoystick.prototype.deltaY	= function(){ return this._stickY - this._baseY;	}

    VirtualJoystick.prototype.up	= function(){
        if( this._pressed === false )	return false;
        var deltaX	= this.deltaX();
        var deltaY	= this.deltaY();
        if( deltaY >= 0 )				return false;
        if( Math.abs(deltaX) > 2*Math.abs(deltaY) )	return false;
        return true;
    }

    VirtualJoystick.prototype.down	= function(){
        if( this._pressed === false )	return false;
        var deltaX	= this.deltaX();
        var deltaY	= this.deltaY();
        if( deltaY <= 0 )				return false;
        if( Math.abs(deltaX) > 2*Math.abs(deltaY) )	return false;
        return true;
    }

    VirtualJoystick.prototype.right	= function(){
        if( this._pressed === false )	return false;
        var deltaX	= this.deltaX();
        var deltaY	= this.deltaY();
        if( deltaX <= 0 )				return false;
        if( Math.abs(deltaY) > 2*Math.abs(deltaX) )	return false;
        return true;
    }

    VirtualJoystick.prototype.left	= function(){
        if( this._pressed === false )	return false;
        var deltaX	= this.deltaX();
        var deltaY	= this.deltaY();
        if( deltaX >= 0 )				return false;
        if( Math.abs(deltaY) > 2*Math.abs(deltaX) )	return false;
        return true;
    }

    VirtualJoystick.prototype._onUp	= function()
    {
        this._pressed	= false;
        this._stickEl.style.display	= "none";

        if(this._stationaryBase == false){
            this._baseEl.style.display	= "none";

            this._baseX	= this._baseY	= 0;
            this._stickX	= this._stickY	= 0;
        }
    }

    VirtualJoystick.prototype._onDown	= function(x, y)
    {
        this._pressed	= true;
        if(this._stationaryBase == false){
            this._baseX	= x;
            this._baseY	= y;
            this._baseEl.style.display	= "";
            this._move(this._baseEl.style, (this._baseX - this._baseEl.width /2), (this._baseY - this._baseEl.height/2));
        }

        this._stickX	= x;
        this._stickY	= y;

        if(this._limitStickTravel === true){
            var deltaX	= this.deltaX();
            var deltaY	= this.deltaY();
            var stickDistance = Math.sqrt( (deltaX * deltaX) + (deltaY * deltaY) );
            if(stickDistance > this._stickRadius){
                var stickNormalizedX = deltaX / stickDistance;
                var stickNormalizedY = deltaY / stickDistance;

                this._stickX = stickNormalizedX * this._stickRadius + this._baseX;
                this._stickY = stickNormalizedY * this._stickRadius + this._baseY;
            }
        }

        this._stickEl.style.display	= "";
        this._move(this._stickEl.style, (this._stickX - this._stickEl.width /2), (this._stickY - this._stickEl.height/2));
    }

    VirtualJoystick.prototype._onMove	= function(x, y)
    {
        if( this._pressed === true ){
            this._stickX	= x;
            this._stickY	= y;

            if(this._limitStickTravel === true){
                var deltaX	= this.deltaX();
                var deltaY	= this.deltaY();
                var stickDistance = Math.sqrt( (deltaX * deltaX) + (deltaY * deltaY) );
                if(stickDistance > this._stickRadius){
                    var stickNormalizedX = deltaX / stickDistance;
                    var stickNormalizedY = deltaY / stickDistance;

                    this._stickX = stickNormalizedX * this._stickRadius + this._baseX;
                    this._stickY = stickNormalizedY * this._stickRadius + this._baseY;
                }
            }

            this._move(this._stickEl.style, (this._stickX - this._stickEl.width /2), (this._stickY - this._stickEl.height/2));
        }
    }

    VirtualJoystick.prototype._onMouseUp	= function(event)
    {
        return this._onUp();
    }

    VirtualJoystick.prototype._onMouseDown	= function(event)
    {
        event.preventDefault();
        var x	= event.clientX;
        var y	= event.clientY;
        return this._onDown(x, y);
    }

    VirtualJoystick.prototype._onMouseMove	= function(event)
    {
        var x	= event.clientX;
        var y	= event.clientY;
        return this._onMove(x, y);
    }

    VirtualJoystick.prototype._onTouchStart	= function(event)
    {
        if( this._touchIdx !== null )	return;

        var isValid	= this.dispatchEvent('touchStartValidation', event);
        if( isValid === false )	return;

        this.dispatchEvent('touchStart', event);

        event.preventDefault();
        var touch	= event.changedTouches[0];
        this._touchIdx	= touch.identifier;

        var x		= touch.pageX;
        var y		= touch.pageY;
        return this._onDown(x, y)
    }

    VirtualJoystick.prototype._onTouchEnd	= function(event)
    {
        if( this._touchIdx === null )	return;

        this.dispatchEvent('touchEnd', event);

        var touchList	= event.changedTouches;
        for(var i = 0; i < touchList.length && touchList[i].identifier !== this._touchIdx; i++);
        if( i === touchList.length)	return;

        this._touchIdx	= null;

        event.preventDefault();

        return this._onUp()
    }

    VirtualJoystick.prototype._onTouchMove	= function(event)
    {
        if( this._touchIdx === null )	return;

        var touchList	= event.changedTouches;
        for(var i = 0; i < touchList.length && touchList[i].identifier !== this._touchIdx; i++ );
        if( i === touchList.length)	return;
        var touch	= touchList[i];

        event.preventDefault();

        var x		= touch.pageX;
        var y		= touch.pageY;
        return this._onMove(x, y)
    }

    VirtualJoystick.prototype._buildJoystickBase	= function()
    {
        var canvas	= document.createElement( 'canvas' );
        canvas.width	= 126;
        canvas.height	= 126;

        var ctx		= canvas.getContext('2d');
        ctx.beginPath();
        ctx.strokeStyle = this._strokeStyle;
        ctx.lineWidth	= 6;
        ctx.arc( canvas.width/2, canvas.width/2, 40, 0, Math.PI*2, true);
        ctx.stroke();

        ctx.beginPath();
        ctx.strokeStyle	= this._strokeStyle;
        ctx.lineWidth	= 2;
        ctx.arc( canvas.width/2, canvas.width/2, 60, 0, Math.PI*2, true);
        ctx.stroke();

        return canvas;
    }

    VirtualJoystick.prototype._buildJoystickStick	= function()
    {
        var canvas	= document.createElement( 'canvas' );
        canvas.width	= 86;
        canvas.height	= 86;
        var ctx		= canvas.getContext('2d');
        ctx.beginPath();
        ctx.strokeStyle	= this._strokeStyle;
        ctx.lineWidth	= 6;
        ctx.arc( canvas.width/2, canvas.width/2, 40, 0, Math.PI*2, true);
        ctx.stroke();
        return canvas;
    }

    VirtualJoystick.prototype._move = function(style, x, y)
    {
        if (this._transform) {
            if (this._has3d) {
                style[this._transform] = 'translate3d(' + x + 'px,' + y + 'px, 0)';
            } else {
                style[this._transform] = 'translate(' + x + 'px,' + y + 'px)';
            }
        } else {
            style.left = x + 'px';
            style.top = y + 'px';
        }
    }

    VirtualJoystick.prototype._getTransformProperty = function()
    {
        var styles = [
            'webkitTransform',
            'MozTransform',
            'msTransform',
            'OTransform',
            'transform'
        ];

        var el = document.createElement('p');
        var style;

        for (var i = 0; i < styles.length; i++) {
            style = styles[i];
            if (null != el.style[style]) {
                return style;
            }
        }
    }

    VirtualJoystick.prototype._check3D = function()
    {
        var prop = this._getTransformProperty();
        if (!prop || !window.getComputedStyle) return module.exports = false;

        var map = {
            webkitTransform: '-webkit-transform',
            OTransform: '-o-transform',
            msTransform: '-ms-transform',
            MozTransform: '-moz-transform',
            transform: 'transform'
        };

        var el = document.createElement('div');
        el.style[prop] = 'translate3d(1px,1px,1px)';
        document.body.insertBefore(el, null);
        var val = getComputedStyle(el).getPropertyValue(map[prop]);
        document.body.removeChild(el);
        return null != val && val.length && 'none' != val;
    }
</script>
<script>

    document.addEventListener('DOMContentLoaded', () => {
        document.body.style.userSelect = 'none';
        document.body.style.MozUserSelect = 'none';
        document.body.style.msUserSelect = 'none';
    });

    console.log(
        "Touchscreen is",
        VirtualJoystick.touchScreenAvailable() ? "available" : "not available"
    );

    const currentPath = window.location.pathname;

    let WS_URL = (window.location.protocol === "https:") ? "wss:" : "ws:";
    WS_URL += "//" + window.location.host;
    WS_URL += currentPath.slice(0, currentPath.lastIndexOf("/") + 1) + "ws";

    const SEND_INTERVAL = 1000 / 30;

    class WebSocketManager {
        constructor(url) {
            this.url = url;
            this.socket = null;
            this.shouldReconnect = true;
            this.reconnectInterval = 3000;
            this.maxReconnectInterval = 30000;
            this.pingInterval=30000;
            this.pingTimer = null;

            this.sessionId = localStorage.getItem("wsSessionID") || this.generateSessionID();
            localStorage.setItem("wsSessionID", this.sessionId);

            document.addEventListener("visibilitychange", () =>{
                if (!document.hidden && this.socket.readyState !== WebSocket.OPEN) {
                    console.log("Page visible. Attempting to reconnect if needed.")
                    this.initializeWebSocket();
                }
            });

            this.initializeWebSocket();

        }

        generateSessionID() {
            return "session-" + Math.random().toString(36).substring(2,9)
        }

        initializeWebSocket() {

            if (this.pingTimer) {
             clearTimeout(this.pingTimer);
             this.pingTimer = null;
            }

            const urlWithSession = this.url +"?session=" + this.sessionId;
            this.socket = new WebSocket(urlWithSession, ["messages"]);

            this.socket.onopen = () => {
                console.log('connected');
                this.reconnectInterval = 3000;
                this.startPing();
            };

            this.socket.onmessage = (event) => {
                console.log('message:', event.data);
            };

            this.socket.onerror = (error) => {
                console.error('error:', error);
            };

            this.socket.onclose = () => {
                console.log('connection closed');
                this.stopPing();
                if (this.shouldReconnect) {
                    this.scheduleReconnect();
                }
            };
        }

        scheduleReconnect() {
            console.log(`Reconnecting in ${this.reconnectInterval / 1000} seconds...`);
            setTimeout(() => {
                if (this.socket.readyState === WebSocket.CLOSED) {
                    console.log('Attempting to reconnect...');
                    this.initializeWebSocket();
                    this.reconnectInterval = Math.min(this.reconnectInterval * 2, this.maxReconnectInterval);
                }
            }, this.reconnectInterval);
        }

        startPing() {
            this.pingTimer = setInterval(() => {
                if (this.socket.readyState === WebSocket.OPEN) {
                    const pingMessage = JSON.stringify({ type: "ping", session: this.sessionId });
                    this.socket.send(pingMessage);
                    console.log("Ping sent");
                }
            }, this.pingInterval);
        }

        stopPing() {
            if (this.pingTimer) {
                clearInterval(this.pingTimer);
                this.pingTimer = null;
            }
        }

        sendCommand(commandObj) {
            const jsonCommand = JSON.stringify(commandObj);
            console.log('Sending:', jsonCommand);
            if (this.socket.readyState === WebSocket.OPEN) {
                this.socket.send(jsonCommand);
                console.log('Sent:', jsonCommand);
            } else {
                console.warn("Cannot send message, socket not open:", jsonCommand);
            }
        }

        disconnect() {
            // Allow for clean disconnect without reconnection
            this.shouldReconnect = false;
            if (this.socket) {
                this.socket.close();
            }
        }

    }

    const wsManager = new WebSocketManager(WS_URL);

    window.joystickActive = false;

    class JoystickController {
        constructor(options) {
            this.joystick = new VirtualJoystick(options);
            this.initializeEvents();
            this.dragging = false;
            this.startX = 0;
            this.startY = 0;
            this.ACTIVATE_THRESHOLD = 20;
        }

        initializeEvents() {
            this.joystick.addEventListener('touchStartValidation', this.validateTouchStart.bind(this));
            this.joystick.addEventListener('touchStart', this.onTouchStart.bind(this));
            this.joystick.addEventListener('touchEnd', this.onTouchEnd.bind(this));
            this.joystick.addEventListener('touchMove', this.onTouchMove.bind(this));
        }

        validateTouchStart(event) {}

        onTouchStart(event) {
            const touch = event.changedTouches ? event.changedTouches[0] : event;
            this.startX = touch.pageX;
            this.startY = touch.pageY;
            this.dragging = false;
        }

        onTouchEnd() {
            if (this.dragging) {
                window.joystickActive = false;
            }
            this.dragging = false;
        }

        onTouchMove(event) {
            if (!this.dragging) {
                const touch = event.changedTouches ? event.changedTouches[0] : event;
                const dx = touch.pageX - this.startX;
                const dy = touch.pageY - this.startY;
                const dist = Math.sqrt(dx * dx + dy * dy);

                if (dist > this.ACTIVATE_THRESHOLD) {
                    this.dragging = true;
                    window.joystickActive = true;
                }
            }
        }
    }

    class LeftJoystick extends JoystickController {
        constructor() {
            super({
                container: document.body,
                strokeStyle: 'blue',
                limitStickTravel: true,
                stickRadius: 120,
                mouseSupport: false,
            });
            this.previousCommand = { s: null, o: null };
        }

        validateTouchStart(event) {
            const touch = event.changedTouches[0];
            return touch.pageX < window.innerWidth / 2;
        }

        onTouchEnd() {
            super.onTouchEnd();
            if (this.dragging) {
                wsManager.sendCommand({
                    ct: "i",
                    ic: "y",
                    s: 0,
                    o: null
                });
            }
        }

        getCommand() {
            const speed = parseFloat(
                calculateYawSpeed(this.joystick.deltaX(), this.joystick.deltaY())
            );
            const orientation = null; // optional
            return {
                ct: "i",
                ic: "y",
                s: speed,
                o: orientation
            };
        }
    }

    class RightJoystick extends JoystickController {
        constructor() {
            super({
                container: document.body,
                strokeStyle: 'white',
                limitStickTravel: true,
                stickRadius: 120,
                mouseSupport: true,
            });
            this.previousCommand = { d: null, s: null };
        }

        validateTouchStart(event) {
            const touch = event.changedTouches[0];
            return touch.pageX >= window.innerWidth / 2;
        }

        onTouchEnd() {
            super.onTouchEnd();
            if (this.dragging) {
                wsManager.sendCommand({
                    ct: "i",
                    ic: "t",
                    d: 0,
                    s: 0
                });
            }
        }

        getCommand() {
            const { speed, direction } = calculateMove(
                this.joystick.deltaX(),
                this.joystick.deltaY()
            );
            return {
                ct: "i",
                ic: "t",
                d: direction,
                s: speed
            };
        }
    }

    const leftJoystick = new LeftJoystick();
    const rightJoystick = new RightJoystick();

    function calculateYawSpeed(deltaX, deltaY) {
        const magnitude = Math.sqrt(deltaX ** 2 + deltaY ** 2);
        const normalizedMagnitude = Math.min(1, magnitude / 120);
        const sign = deltaX >= 0 ? 1 : -1;
        const yawSpeed = sign * normalizedMagnitude;
        return yawSpeed.toFixed(1);
    }
    function calculateMove(deltaX, deltaY) {
        const magnitude = Math.sqrt(deltaX ** 2 + deltaY ** 2);
        const normalizedMagnitude = Math.min(1, magnitude / 120);
        let angle = (Math.atan2(deltaY, deltaX) * (180 / Math.PI)) + 90;
        angle = (angle + 360) % 360;
        const speed = magnitude === 0 ? 0 : parseFloat(normalizedMagnitude.toFixed(2));
        const direction = magnitude === 0 ? 0 : Math.round(angle);
        return { speed, direction };
    }

    let previousYCommand = { s: null, o: null };
    let previousTCommand = { d: null, s: null };


    setInterval(() => {

        const currentY = leftJoystick.getCommand();
        const currentT = rightJoystick.getCommand();

        if (
            currentY.s !== previousYCommand.s ||
            currentY.o !== previousYCommand.o
        ) {
            wsManager.sendCommand(currentY);
            previousYCommand = { ...currentY };
            console.log('Yaw:', currentY);
        }

        if (
            currentT.d !== previousTCommand.d ||
            currentT.s !== previousTCommand.s
        ) {
            wsManager.sendCommand(currentT);
            previousTCommand = { ...currentT };
            console.log('Move:', currentT);
        }
    }, SEND_INTERVAL);

    const DOUBLE_TAP_THRESHOLD = 300;
    const LONG_PRESS_THRESHOLD = 1000;
    const MOVE_THRESHOLD = 20;

    let lastTapTimeLeft = 0;
    let lastTapTimeRight = 0;
    let isLightsOn = false;

    let startX = 0;
    let startY = 0;
    let touchStartTime = 0;
    let touchSide = null;
    let touchMoved = false;
    let longPressTimer = null;

    function onGlobalTouchStart(event) {
        if (window.joystickActive) return;

        const touch = event.changedTouches ? event.changedTouches[0] : event;
        startX = touch.pageX;
        startY = touch.pageY;
        touchStartTime = Date.now();
        touchMoved = false;

        touchSide = (touch.pageX < window.innerWidth / 2) ? 'left' : 'right';

        longPressTimer = setTimeout(() => {
            if (touchSide === 'left') {
                console.log('Long press on LEFT');
                wsManager.sendCommand({ POWER_LEFT: 'TOGGLE' });
            } else {
                console.log('Long press on RIGHT');
                wsManager.sendCommand({ POWER_RIGHT: 'TOGGLE' });
            }
            longPressTimer = null; // reset
        }, LONG_PRESS_THRESHOLD);
    }
    function onGlobalTouchMove(event) {
        if (window.joystickActive) return;

        const touch = event.changedTouches ? event.changedTouches[0] : event;
        const deltaX = touch.pageX - startX;
        const deltaY = touch.pageY - startY;
        const dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY);

        if (dist > MOVE_THRESHOLD) {
            touchMoved = true;
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
        }
    }
    function onGlobalTouchEnd(event) {
        if (window.joystickActive) return;

        if (longPressTimer) {
            clearTimeout(longPressTimer);
            longPressTimer = null;
        }

        if (touchMoved) return;
        const now = Date.now();
        if (touchSide === 'left') {
            if (now - lastTapTimeLeft < DOUBLE_TAP_THRESHOLD) {
                console.log('DTL');
                if (isLightsOn) {
                    wsManager.sendCommand({
                        ct: "l",
                        lc: "off"
                    });
                    isLightsOn = false;
                } else {
                    wsManager.sendCommand({
                        ct: "l",
                        lc: "on"
                    });
                    isLightsOn = true;
                }
                lastTapTimeLeft = 0;
            } else {
                lastTapTimeLeft = now;
            }
        } else {
            if (now - lastTapTimeRight < DOUBLE_TAP_THRESHOLD) {
                console.log('DTR');
                wsManager.sendCommand({ LIGHTS_RIGHT: 'TOGGLE' });
                lastTapTimeRight = 0;
            } else {
                lastTapTimeRight = now;
            }
        }
    }

    document.addEventListener('touchstart', onGlobalTouchStart, { passive: false });
    document.addEventListener('touchmove', onGlobalTouchMove, { passive: false });
    document.addEventListener('touchend', onGlobalTouchEnd, { passive: false });

    document.addEventListener('mousedown', onGlobalTouchStart);
    document.addEventListener('mousemove', onGlobalTouchMove);
    document.addEventListener('mouseup', onGlobalTouchEnd);
</script>
</body>
</html>